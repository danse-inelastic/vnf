#!/usr/bin/env python
#
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#                                Jiao  Lin
#                      California Institute of Technology
#                        (C) 2009  All Rights Reserved
#
# {LicenseText}
#
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#


from pyre.components.Component import Component


class Template(Component):

    class Inventory(Component.Inventory):

        import pyre.inventory
        form = pyre.inventory.str('form', default='testform')
        

    def create(self, name=None):
        
        form = self.inventory.form
        
        text = [
            "from vnf.components.FormActor import FormActor as base, action, InputProcessingError",
            "",
            "",
            "class Actor( base ):",
            "",
            "    class Inventory( base.Inventory ):",
            "",
            "        import pyre.inventory",
            "",
            "        # *** Parameters for this actor ***",
            "",
            "        pass # end of Inventory",
            "",
            "",
            "    def __init__(self, name = '%s'):" % name,
            "        base.__init__(self, name)",
            "        return",
            "",
            "",
            "    def helloWorld(self, director):",
            "        page = director.retrievePage( 'greet' )",
            "        main = page._body._content._main",
            "        document = main.document(",
            "            title='%s')" % name,
            "",
            "        p = document.paragraph()",
            "        p.text = ['Hello, world!']",
            "        return page",
            "",
            "    default = helloWorld",
            "",
            "",
            "    def presentForm(self, director, errors=None):",
            "        page = director.retrievePage('greet')",
            "        main = page._body._content._main",
            "",
            "        # populate the main column",
            "        document = main.document(title='%s: Present a form')" % name,
            "        document.description = ''",
            "        ",
            "        formcomponent = self.retrieveFormToShow(",
            "            '%s' )" % form,
            "        formcomponent.director = director",
            "",
            "        # create form",
            "        form = document.form(",
            "            name='testform',",
            "            legend= formcomponent.legend(),",
            "            action=director.cgihome)",
            "",
            "        # specify action",
            "        submit_action = action(",
            "            label = '', ",
            "            actor = '%s', routine = 'verify'," % name,
            "            arguments = {'form-received': formcomponent.name } )",
            "        from vnf.weaver import action_formfields",
            "        action_formfields( submit_action, form )",
            "",
            "        # expand the form with fields of the data object that is being edited",
            "        formcomponent.expand(form, errors=errors)",
            "",
            "        # submit button",
            "        submit = form.control(",
            "            name='actor.form-received.submit', type='submit', value='Submit')",
            "",
            "        return page",
            "",
            "",
            "    def verify(self, director):",
            "        form_received = self.form_received",
            "        try:",
            "            inputs = self.processFormInputs(director)",
            "        except InputProcessingError, err:",
            "            errors = err.errors",
            "            return self.presentForm(director, errors=errors)",
            "",
            "        page = director.retrievePage( 'greet' )",
            "        main = page._body._content._main",
            "        document = main.document(",
            "            title='%s: received user inputs')" % name,
            "",
            "        p = document.paragraph()",
            "        p.text = ['Your input for energy is: %s' % inputs.energy]",
            "        return page",
            "",
            "",
            "",
            "def actor():",
            "    return Actor( ) ",
            "",
            ]
        return text
    

def template():
    return Template('actor', 'template') 



# version
__id__ = "$Id$"

# End of file 
