#!/usr/bin/env python
#
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#                      California Institute of Technology
#                        (C) 2009  All Rights Reserved
#
# {LicenseText}
#
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#

import luban.content as lc
#from vnfb.utils.qegrid import QEGrid

from luban.content import load, select

def visual(director):
    doc         = lc.document(title = "New Analysis")
    splitter    = doc.splitter(orientation="vertical")
    sA          = splitter.section()
    sA.add(viewIndicator(director))

    sB          = splitter.section()
    sp = lc.splitter(); sB.add(sp)
    
    left = sp.section()#title='Structure Analysis')
    docLeft         = lc.document(title = "Structure")
    left.add(docLeft)
    left.add(createStructureAnalysis())
             
    middle = sp.section()#title='Dynamics Analysis')
    docMiddle        = lc.document(title = "Dynamics")
    middle.add(docMiddle)
    middle.add(createDynamicsAnalysis())
    
    right = sp.section()#title='Scattering Analysis')
    docRight = lc.document(title = 'Scattering')
    right.add(docRight)
    right.add(createScatteringAnalysis())
    
#    table       = QEGrid(lc.grid(Class="qe-table"))
#    sB.add(table.grid())
#    showAnalyses(table)
#
#    table.setColumnStyle(0, "qe-cell-param")
    return doc

def createStructureAnalysis():
    grid = lc.grid()
    
    routines   = []
    routines.append(
                    (lc.link(label="RDF", 
                             onclick=load(actor="orm/rdfcalc", routine='edit')),
                    "Radial Distribution Function from an MD trajectory")
                    )
    
    for link,desc in routines:
        row = grid.row()
        row.cell().add(link)
        row.cell().add(desc)
    return grid

def createDynamicsAnalysis():
    grid = lc.grid()
    
    routines   = []
    routines.append(
                    (lc.link(label="DoPS", onclick=select(id='main-display-area'
                            ).replaceContent(load(actor="orm/motiondoscalc", routine='edit', id='2'))),
                    "Density of Phonon States from an MD trajectory")
                    )
    routines.append(
                    (lc.link(label="VACF", onclick=select(id='main-display-area'
                            ).replaceContent(load(actor="orm/vacfcalc", routine='edit', id='2'))),
                    "Velocity Autocorrelation Function from an MD trajectory")
                    )
    routines.append(
                    (lc.link(label="MSD", onclick=select(id='main-display-area'
                            ).replaceContent(load(actor="orm/msdcalc", routine='edit', id='2'))),
                    "Mean Squared Displacement from an MD trajectory")
                    )
    routines.append(
                    (lc.link(label="Diffusion", onclick=load(actor="orm/diffusioncalc", routine='edit')),
                    "Generate a diffusion coefficient from an MD trajectory")
                    )
    
    for link,desc in routines:
        row = grid.row()
        row.cell().add(link)
        row.cell().add(desc)
    return grid

def createScatteringAnalysis():
    grid = lc.grid()
    
    routines   = []
    routines.append(
                    (lc.link(label="S(Q,E)", onclick=load(actor="orm/csfcalc", routine='edit')),
                    "Generate coherent and incoherent portions of inelastic scattering through an MD trajectory"))
    routines.append(
                    (lc.link(label="EISF", onclick=load(actor="orm/eisfcalc", routine='edit')
                             ),
                    "Elastic Incoherent Structure Factor from an MD trajectory")
                    )
    routines.append(
                    (lc.link(label="Static S(Q)", onclick=load(actor="orm/staticsqcalc", routine='edit')),
                    "Static Structure Factor from an MD trajectory")
                    )
    routines.append(
                    (lc.link(label="Dynamic S(Q)", onclick=load(actor="orm/dynamicsqcalc", routine='edit')),
                    "Dynamic Structure Factor from an MD trajectory")
                    )
    routines.append(
                    (lc.link(label="Multiphonon Scattering", onclick=load(actor="orm/multiscatcalc", routine='edit')),
                    "Add multiphonon scattering corrections to an S(Q,E)")
                    )
    
    for link,desc in routines:
        row = grid.row()
        row.cell().add(link)
        row.cell().add(desc)
    return grid





def viewIndicator(director):
    path = []
    path.append(('Simulations ', load(actor='materialsimulation', routine='edit')))
    path.append('Create New Simulation')
    
    return director.retrieveVisual('view-indicator', path=path)



__date__ = "$Nov 20, 2009 3:11:39 PM$"


